
// cristinel.ababei 
// examples of creating sounds;
// 1-- just a beep, boring one
// 2-- another beep, cooler
// 3-- a sine wave

#include "LPC17xx.H" 

#define DAC_BIAS (0x1<<16)
#define DATA_LENGTH	0x400

uint64_t pitch = 0;

/* Table of sin values, used for creating the desired pitches */
int sinWave[1024] = 
{
  0, 3, 5, 8, 10, 13, 15, 18, 20, 23, 25, 28, 30, 33, 35, 38, 40, 43, 45, 48, 50, 53, 
	55, 58, 60, 63, 65, 68, 70, 73, 75, 78, 80, 82, 85, 87, 90, 92, 95, 97, 100, 102, 104, 
	107, 109, 112, 114, 117, 119, 121, 124, 126, 129, 131, 133, 136, 138, 140, 143, 145, 
	148, 150, 152, 155, 157, 159, 162, 164, 166, 168, 171, 173, 175, 178, 180, 182, 184, 
	187, 189, 191, 193, 195, 198, 200, 202, 204, 206, 209, 211, 213, 215, 217, 219, 221, 
	224, 226, 228, 230, 232, 234, 236, 238, 240, 242, 244, 246, 248, 250, 252, 254, 256, 
	258, 260, 262, 264, 266, 268, 270, 272, 273, 275, 277, 279, 281, 283, 285, 286, 288, 
	290, 292, 293, 295, 297, 299, 300, 302, 304, 305, 307, 309, 310, 312, 314, 315, 317, 
	319, 320, 322, 323, 325, 326, 328, 329, 331, 332, 334, 335, 337, 338, 339, 341, 342, 
	344, 345, 346, 348, 349, 350, 352, 353, 354, 355, 357, 358, 359, 360, 362, 363, 364, 
	365, 366, 367, 368, 370, 371, 372, 373, 374, 375, 376, 377, 378, 379, 380, 381, 382, 
	383, 383, 384, 385, 386, 387, 388, 389, 389, 390, 391, 392, 392, 393, 394, 394, 395, 
	396, 396, 397, 398, 398, 399, 399, 400, 401, 401, 402, 402, 403, 403, 404, 404, 404, 
	405, 405, 406, 406, 406, 407, 407, 407, 408, 408, 408, 408, 408, 409, 409, 409, 409, 
	409, 410, 410, 410, 410, 410, 410, 410, 410, 410, 410, 410, 410, 410, 410, 410, 410, 
	410, 409, 409, 409, 409, 409, 408, 408, 408, 408, 408, 407, 407, 407, 406, 406, 406, 
	405, 405, 404, 404, 404, 403, 403, 402, 402, 401, 401, 400, 399, 399, 398, 398, 397, 
	396, 396, 395, 394, 394, 393, 392, 392, 391, 390, 389, 389, 388, 387, 386, 385, 384, 
	383, 383, 382, 381, 380, 379, 378, 377, 376, 375, 374, 373, 372, 371, 370, 368, 367, 
	366, 365, 364, 363, 362, 360, 359, 358, 357, 355, 354, 353, 352, 350, 349, 348, 346, 
	345, 344, 342, 341, 339, 338, 337, 335, 334, 332, 331, 329, 328, 326, 325, 323, 322, 
	320, 319, 317, 315, 314, 312, 310, 309, 307, 305, 304, 302, 300, 299, 297, 295, 293, 
	292, 290, 288, 286, 285, 283, 281, 279, 277, 275, 273, 272, 270, 268, 266, 264, 262, 
	260, 258, 256, 254, 252, 250, 248, 246, 244, 242, 240, 238, 236, 234, 232, 230, 228, 
	226, 224, 221, 219, 217, 215, 213, 211, 209, 206, 204, 202, 200, 198, 195, 193, 191, 
	189, 187, 184, 182, 180, 178, 175, 173, 171, 168, 166, 164, 162, 159, 157, 155, 152, 
	150, 148, 145, 143, 140, 138, 136, 133, 131, 129, 126, 124, 121, 119, 117, 114, 112, 
	109, 107, 104, 102, 100, 97, 95, 92, 90, 87, 85, 82, 80, 78, 75, 73, 70, 68, 65, 63, 
	60, 58, 55, 53, 50, 48, 45, 43, 40, 38, 35, 33, 30, 28, 25, 23, 20, 18, 15, 13, 10, 
	8, 5, 3, 0, -3, -5, -8, -10, -13, -15, -18, -20, -23, -25, -28, -30, -33, -35, -38, 
	-40, -43, -45, -48, -50, -53, -55, -58, -60, -63, -65, -68, -70, -73, -75, -78, -80, 
	-82, -85, -87, -90, -92, -95, -97, -100, -102, -104, -107, -109, -112, -114, -117, 
	-119, -121, -124, -126, -129, -131, -133, -136, -138, -140, -143, -145, -148, -150, 
	-152, -155, -157, -159, -162, -164, -166, -168, -171, -173, -175, -178, -180, -182, 
	-184, -187, -189, -191, -193, -195, -198, -200, -202, -204, -206, -209, -211, -213, 
	-215, -217, -219, -221, -224, -226, -228, -230, -232, -234, -236, -238, -240, -242, 
	-244, -246, -248, -250, -252, -254, -256, -258, -260, -262, -264, -266, -268, -270, 
	-272, -273, -275, -277, -279, -281, -283, -285, -286, -288, -290, -292, -293, -295, 
	-297, -299, -300, -302, -304, -305, -307, -309, -310, -312, -314, -315, -317, -319, 
	-320, -322, -323, -325, -326, -328, -329, -331, -332, -334, -335, -337, -338, -339, 
	-341, -342, -344, -345, -346, -348, -349, -350, -352, -353, -354, -355, -357, -358, 
	-359, -360, -362, -363, -364, -365, -366, -367, -368, -370, -371, -372, -373, -374, 
	-375, -376, -377, -378, -379, -380, -381, -382, -383, -383, -384, -385, -386, -387, 
	-388, -389, -389, -390, -391, -392, -392, -393, -394, -394, -395, -396, -396, -397, 
	-398, -398, -399, -399, -400, -401, -401, -402, -402, -403, -403, -404, -404, -404, 
	-405, -405, -406, -406, -406, -407, -407, -407, -408, -408, -408, -408, -408, -409, 
	-409, -409, -409, -409, -410, -410, -410, -410, -410, -410, -410, -410, -410, -410, 
	-410, -410, -410, -410, -410, -410, -410, -409, -409, -409, -409, -409, -408, -408, 
	-408, -408, -408, -407, -407, -407, -406, -406, -406, -405, -405, -404, -404, -404, 
	-403, -403, -402, -402, -401, -401, -400, -399, -399, -398, -398, -397, -396, -396, 
	-395, -394, -394, -393, -392, -392, -391, -390, -389, -389, -388, -387, -386, -385, 
	-384, -383, -383, -382, -381, -380, -379, -378, -377, -376, -375, -374, -373, -372, 
	-371, -370, -368, -367, -366, -365, -364, -363, -362, -360, -359, -358, -357, -355, 
	-354, -353, -352, -350, -349, -348, -346, -345, -344, -342, -341, -339, -338, -337, 
	-335, -334, -332, -331, -329, -328, -326, -325, -323, -322, -320, -319, -317, -315, 
	-314, -312, -310, -309, -307, -305, -304, -302, -300, -299, -297, -295, -293, -292, 
	-290, -288, -286, -285, -283, -281, -279, -277, -275, -273, -272, -270, -268, -266, 
	-264, -262, -260, -258, -256, -254, -252, -250, -248, -246, -244, -242, -240, -238, 
	-236, -234, -232, -230, -228, -226, -224, -221, -219, -217, -215, -213, -211, -209, 
	-206, -204, -202, -200, -198, -195, -193, -191, -189, -187, -184, -182, -180, -178, 
	-175, -173, -171, -168, -166, -164, -162, -159, -157, -155, -152, -150, -148, -145, 
	-143, -140, -138, -136, -133, -131, -129, -126, -124, -121, -119, -117, -114, -112, 
	-109, -107, -104, -102, -100, -97, -95, -92, -90, -87, -85, -82, -80, -78, -75, -73, 
	-70, -68, -65, -63, -60, -58, -55, -53, -50, -48, -45, -43, -40, -38, -35, -33, -30, 
	-28, -25, -23, -20, -18, -15, -13, -10, -8, -5, -3
};

/* Init the DAC so we can play sound on the speaker. */
void DACInit( void ) {
  LPC_PINCON->PINSEL1 = 0x00200000;  // set P0.26 to DAC output;  
  LPC_DAC->DACCNTVAL = 0x00FF;
  LPC_DAC->DACCTRL = (0x1<<1)|(0x1<<2);
  return;
}

/* Play a specified sound. Note: The input variable is not really a frequency.
   This function needs work.
*/
void playSound(int freq) {
	uint64_t i = 0;
	for (i = 0; i < 22056; i++) {
		int freq1 = freq*i*(1024./44111);
		pitch = 0.5*sinWave[freq1%1024];
		LPC_DAC->DACR = (pitch << 8); // 8 bit sound
	}
}
